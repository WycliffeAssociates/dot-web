---
import {actions} from "astro:actions";
import {AppWrapper} from "@components/AppWrapper";
// home page
import Layout from "@layouts/Layout.astro";

// Get all shared page data
const {data: pageData, error} = await Astro.callAction(actions.getPageData, {});
if (error || !pageData) return Astro.redirect("/404");

const {
  playlist,
  playlistDisplayName,
  preferredLocale,
  initialDict,
  videojsInitalDict,
  userPreferences,
  bucketized,
  cfEnv,
} = pageData;

// HOME PAGE SPECIFIC LOGIC
const defaultBook = bucketized[Object.keys(bucketized)[0]];
const defaultChap = defaultBook[0];

const initialData = {
  vids: defaultBook,
  chap: defaultChap,
  verseRouting: undefined,
};
---

<Layout
  title={`DOT ${playlist}`}
  initialDict={initialDict}
  preferredLocale={preferredLocale}
>
  <div class="grid grid-rows-[auto_auto_1fr] overflow-y-auto">
    <AppWrapper
      client:load
      userPreferences={userPreferences}
      initialData={initialData}
      playlist={playlist}
      playlistDisplayName={playlistDisplayName}
      vids={bucketized}
      locale={preferredLocale}
      initialDict={initialDict}
      videojsInitalDict={videojsInitalDict}
      playerEnv={cfEnv}
    />
  </div>
</Layout>
